# Тестирование глубоких моделей

## Тестирование глубоких моделей с использованием Inference Engine в составе Intel® Distribution of OpenVINO™ toolkit

### Тестирование глубоких моделей в синхронном режиме

#### Параметры командной строки

Обязательные параметры:
- `-m / --model` - путь до xml-файла с описанием модели.
- `-w / --weights` - путь до бинарного файла, содержащего веса обученной модели.
- `-i / --input` - путь до изображения или директории с изображениями,
  расширения файлов `.jpg`, `.png`, `.bmp` и т.д.

Необязательные параметры:
- `-b / --batch_size` - количество изображений, которые будут обработаны
  за один проход сети. По умолчанию равно `1`.
- `-l / --extension` - абсолютный путь к библиотеке 
  с реализацией нестандартных слоёв для устройств `CPU` и `MYRIAD`.
- `-c / --cldnn_config` - абсолютный путь к библиотеке с реализацией
  нестандартных словек для устройства `GPU`.
- `-d / --device` - оборудование (`CPU`, `GPU`, `FPGA`, `MYRIAD`),
  на котором будет выполнен проход сети. По умолчанию вывод осуществляется
  на `CPU`. Так же доступны режимы геторогенного и вывод с одновременным
  использованием нескольких устройств(`HETERO:<Device1>,<Device2>,..`,
  `MULTI:<Device1>,<Device2>,..`).
- `--dump` - сохранить информацию об исполнении модели.
- `-p / --priority` - приоритет для вывода с одновременным использованием нескольких
  устройств.
- `--labels` - путь до файла с перечнем классов при решении задачи
  классификации.
- `-nt / --number_top` - число лучших результатов, выводимых
  при решении задачи классификации. По умолчанию выводится `10` наилучших
  результатов.
- `-ni / --number_iter` - количество прямых проходов сети. По умолчанию
  выполняется один проход сети.
- `-nthreads / --number_threads` - максимальное число потоков исполнения вывода.
  По умолчанию будет использоваться максимальное количество потоков.
- `-t / --task` - имя решаемой задачи. Для просмотра списка задач используйте
  ```bash
  python inference_sync_mode.py -h
  ```
  По умолчанию обработка выхода не производится.
- `--color_map` - путь до карты цветов при решении задачи семантической
  сегментации.
- `--prob_threshold` - порог вероятности для фильтрации результатов и 
  отбрасывания лишних окаймляющих прямоугольников  при решении задачи детектирования.
  По умолчанию равен `0.5`.
- `-mi / -mininfer` - минимальное допустимое время выполнения вывода.
  По умолчанию равно нулю.

#### Примеры запусков

**Командная строка для решения задачи классификации изображений**
```bash
python inference_sync_mode.py \
    -t classification -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.xml -w <path_to_weights>/<model_name>.bin \
    --labels <path_to_labels>/image_net_synset.txt
```

Результат выполнения: набор наиболее вероятных классов, которым принадлежит
изображение.

**Командная строка для решения задачи детектирования объектов**
```bash
python inference_sync_mode.py \
    -t detection -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.xml -w <path_to_weights>/<model_name>.bin
```

Результат выполнения: набор окаймляющих прямоугольников, соответствующих
обнаруженным объектам, изображение, разрешение которого совпадает с разрешением
входного изображения, на котором отрисованы окаймляющие прямоугольники.

**Командная строка для решения задачи семантической сегментации изображений**
```bash
python inference_sync_mode.py \
    -t segmentation -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.xml -w <path_to_weights>/<model_name>.bin \
    --color_map <path_to_color_map>/color_map.txt
```

Результат выполнения: изображение, разрешение которого совпадает с разрешением
входного изображения; интенсивность пикселя соответствует классу объектов,
которому принадлежит даннная точка на изображении.

### Тестирование глубоких моделей в асинхронном режиме

#### Параметры командной строки

Обязательные параметры:
- `-m / --model` - путь до xml-файла с описанием модели.
- `-w / --weights` - путь до бинарного файла, содержащего веса обученной модели.
- `-i / --input` - путь до изображения или директории с изображениями,
  расширения файлов `.jpg`, `.png`, `.bmp` и т.д.

Необязательные параметры:
- `-r / --request` - количество запросов на одновременное выполнения вывода.
  По умолчанию выставляется оптимальное количество запросов.
- `-b / --batch_size` - количество изображений, которые будут обработаны
  за один проход сети. По умолчанию равно `1`.
- `-l / --extension` - абсолютный путь к библиотеке 
  с реализацией нестандартных слоёв для устройств `CPU` и `MYRIAD`.
- `-c / --cldnn_config` - абсолютный путь к библиотеке с реализацией
  нестандартных словек для устройства `GPU`.
- `-d / --device` - оборудование (`CPU`, `GPU`, `FPGA`, `MYRIAD`),
  на котором будет выполнен проход сети. По умолчанию вывод осуществляется
  на `CPU`. Так же доступны режимы геторогенного и вывод с одновременным
  использованием нескольких устройств(`HETERO:<Device1>,<Device2>,..`,
  `MULTI:<Device1>,<Device2>,..`).
- `--dump` - сохранить информацию об исполнении модели.
- `-p / --priority` - приоритет для вывода с одновременным использованием нескольких
  устройств.
- `--labels` - путь до файла с перечнем классов при решении задачи
  классификации.
- `-nt / --number_top` - число лучших результатов, выводимых
  при решении задачи классификации. По умолчанию выводится `10` наилучших
  результатов.
- `-ni / --number_iter` - количество прямых проходов сети. По умолчанию
  выполняется один проход сети.
- `-nthreads / --number_threads` - максимальное число потоков исполнения вывода.
  По умолчанию будет использоваться максимальное количество потоков.
- `-nstreams / --number_streams` - максимальное число потоков исполнения запросов на
  вывод. По умолчанию выставляется оптимальное значение. Оптимальное значение зависит
  от исполняемого устройства.
- `-t / --task` - имя решаемой задачи. Для просмотра списка задач используйте
  ```bash
  python inference_async_mode.py -h
  ```
  По умолчанию обработка выхода не производится.
- `--color_map` - путь до карты цветов при решении задачи семантической
  сегментации.
- `--prob_threshold` - порог вероятности для фильтрации результатов и 
  отбрасывания лишних окаймляющих прямоугольников  при решении задачи детектирования.
  По умолчанию равен `0.5`.

#### Примеры запусков

**Командная строка для решения задачи классификации изображений**
```bash
python inference_async_mode.py \
    -t classification -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.xml -w <path_to_weights>/<model_name>.bin \
    --labels <path_to_labels>/image_net_synset.txt
```

Результат выполнения: набор наиболее вероятных классов, которым принадлежит
изображение.

**Командная строка для решения задачи детектирования объектов**
```bash
python inference_async_mode.py \
    -t detection -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.xml -w <path_to_weights>/<model_name>.bin
```

Результат выполнения: набор окаймляющих прямоугольников, соответствующих
обнаруженным объектам, изображение, разрешение которого совпадает с разрешением
входного изображения, на котором отрисованы окаймляющие прямоугольники.

**Командная строка для решения задачи семантической сегментации изображений**
```bash
python inference_async_mode.py \
    -t segmentation -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.xml -w <path_to_weights>/<model_name>.bin \
    --color_map <path_to_color_map>/color_map.txt
```

Результат выполнения: изображение, разрешение которого совпадает с разрешением
входного изображения; интенсивность пикселя соответствует классу объектов,
которому принадлежит даннная точка на изображении.

## Тестирование глубоких моделей с использованием Intel Caffe

#### Параметры командной строки

Обязательные параметры:
- `-m / --model` - путь до xml-файла с описанием модели.
- `-w / --weights` - путь до бинарного файла, содержащего веса обученной модели.
- `-i / --input` - путь до изображения или директории с изображениями,
  расширения файлов `.jpg`, `.png`, `.bmp` и т.д.

Необязательные параметры:
- `-b / --batch_size` - количество изображений, которые будут обработаны
  за один проход сети. По умолчанию равно `1`.
- `-d / --device` - оборудование, на котором будет выполнен проход сети. 
  В данный момент вывод осуществляется только на `CPU`.
- `--labels` - путь до файла с перечнем классов при решении задачи
  классификации.
- `-nt / --number_top` - число лучших результатов, выводимых
  при решении задачи классификации. По умолчанию выводится `10` наилучших
  результатов.
- `-ni / --number_iter` - количество прямых проходов сети. По умолчанию
  выполняется один проход сети.
- `-t / --task` - имя решаемой задачи (`classification`, 
  `detection`, `segmentation`). По умолчанию обработка выхода не производится.
- `--color_map` - путь до карты цветов при решении задачи семантической
  сегментации.
- `--prob_threshold` - порог вероятности для фильтрации результатов и 
  отбрасывания лишних окаймляющих прямоугольников  при решении задачи детектирования.
  По умолчанию равен `0.5`.
- `--channel_swap` - порядок цветовых каналов изображения. 
  По умолчанию порядок `(2, 1, 0)`.
- `--raw_scale` - коэффициент  масштабирования изображения. По умолчанию равен `1`.
- `--mean` - параметры для вычитания средних по каждому цветовому каналу изображения.
  По умолчанию `(0, 0, 0)`.

#### Примеры запусков

**Командная строка для решения задачи классификации изображений**
```bash
python inference_caffe.py \
    -t classification -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.caffemodel \
    -w <path_to_weights>/<model_name>.prototxt \
    --labels <path_to_labels>/image_net_synset.txt
```

Результат выполнения: набор наиболее вероятных классов, которым принадлежит
изображение.

**Командная строка для решения задачи детектирования объектов**
```bash
python inference_caffe.py \
    -t detection -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.caffemodel \
    -w <path_to_weights>/<model_name>.prototxt
```

Результат выполнения: набор окаймляющих прямоугольников, соответствующих
обнаруженным объектам, изображение, разрешение которого совпадает с разрешением
входного изображения, на котором отрисованы окаймляющие прямоугольники.

**Командная строка для решения задачи семантической сегментации изображений**
```bash
python inference_caffe.py \
    -t segmentation -i <path_to_image>/<image_name> \
    -m <path_to_model>/<model_name>.caffemodel \
    -w <path_to_weights>/<model_name>.prototxt \
    --color_map <path_to_color_map>/color_map.txt
```

Результат выполнения: изображение, разрешение которого совпадает с разрешением
входного изображения; интенсивность пикселя соответствует классу объектов,
которому принадлежит даннная точка на изображении.
